<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuesioner Pengetahuan Diabetes (DKQ-24)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .form-content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .question-text {
            font-size: 1.05em;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .question-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            cursor: pointer;
        }

        .radio-option label {
            cursor: pointer;
            font-weight: normal;
            margin: 0;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .result-card {
            display: none;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: center;
        }

        .result-card h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .result-card .score {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }

        .result-card .interpretation {
            font-size: 1.2em;
            margin-top: 15px;
            line-height: 1.6;
        }

        .error-message {
            background: #ff4444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .success-message {
            background: #00C851;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .config-note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
        }

        .config-note strong {
            color: #856404;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .form-content {
                padding: 20px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Kuesioner Pengetahuan Diabetes</h1>
            <p>DKQ-24 (Diabetes Knowledge Questionnaire)</p>
        </div>

        <div class="form-content">
            <div class="config-note">
                <strong>‚öôÔ∏è Konfigurasi:</strong> Pastikan Anda sudah mengatur SCRIPT_URL di bagian JavaScript dengan URL dari Google Apps Script Anda.
            </div>

            <form id="dkqForm">
                <div class="form-group">
                    <label for="nama">Nama Lengkap:</label>
                    <input type="text" id="nama" name="nama" required>
                </div>

                <div id="questionsContainer"></div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    üìä Submit & Lihat Hasil
                </button>

                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>
                <div class="result-card" id="resultCard"></div>
            </form>
        </div>
    </div>

    <script>
        // GANTI URL INI DENGAN URL GOOGLE APPS SCRIPT ANDA
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyxYC7KM2v0MhcOmmNUb_9jsHJmL3Qo1u4bg9BLMWu1_tSJqecbTqt_12AO4cTIoaqUZg/exec';

        const questions = [
            "Makan terlalu banyak gula dan makanan manis lainnya merupakan penyebab diabetes",
            "Penyebab umum diabetes adalah kurangnya insulin yang efektif dalam tubuh",
            "Diabetes disebabkan karena kegagalan ginjal mencegah gula masuk ke dalam kencing",
            "Ginjal memproduksi insulin",
            "Pada diabetes yang tidak diobati, jumlah gula dalam darah biasanya meningkat",
            "Jika saya menderita diabetes, anak-anak saya berpeluang lebih besar menderita diabetes juga",
            "Diabetes Melitus dapat disembuhkan",
            "Kadar gula darah puasa 210 adalah terlalu tinggi",
            "Cara terbaik untuk memeriksa diabetes adalah dengan tes urin",
            "Olah raga teratur akan meningkatkan kebutuhan atas insulin atau obat diabetes lainnya",
            "Ada dua jenis utama diabetes: Tipe 1 (tergantung pada insulin) dan Tipe 2 (tidak tergantung pada insulin)",
            "Insulin bekerja disebabkan karena makan terlalu banyak",
            "Obat lebih penting daripada diet dan olah raga untuk mengendalikan diabetes",
            "Diabetes sering menyebabkan peredaran darah yang tidak baik",
            "Luka dan lecet pada penderita diabetes sembuhnya lama",
            "Penderita diabetes harus sangat berhati-hati saat memotong kuku kaki",
            "Penderita diabetes harus membersihkan luka dengan yodium (betadine) dan alkohol",
            "Cara memasak makanan sama pentingnya dengan makanan yang dimakan oleh penderita diabetes",
            "Diabetes dapat merusak ginjal",
            "Diabetes dapat menyebabkan mati rasa pada tangan, jari-jari dan kaki",
            "Gemetaran dan berkeringat merupakan tanda tingginya kadar gula darah",
            "Sering kencing dan haus merupakan tanda rendahnya kadar gula darah",
            "Kaos kaki yang ketat boleh dipakai oleh penderita diabetes",
            "Diet diabetes sebagian besar terdiri dari makanan-makanan khusus"
        ];

        // Kunci jawaban (true = Benar, false = Salah)
        const answerKey = [
            false, true, false, false, true, true, false, true, false, false,
            true, false, false, true, true, true, false, false, true, true,
            false, false, false, false
        ];

        // Render questions
        const container = document.getElementById('questionsContainer');
        questions.forEach((question, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-card';
            questionDiv.innerHTML = `
                <div class="question-text">
                    <span class="question-number">${index + 1}</span>
                    ${question}
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q${index}_benar" name="q${index}" value="benar" required>
                        <label for="q${index}_benar">Benar</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q${index}_salah" name="q${index}" value="salah">
                        <label for="q${index}_salah">Salah</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q${index}_tidak_tahu" name="q${index}" value="tidak_tahu">
                        <label for="q${index}_tidak_tahu">Tidak Tahu</label>
                    </div>
                </div>
            `;
            container.appendChild(questionDiv);
        });

        // Handle form submission
        document.getElementById('dkqForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const nama = document.getElementById('nama').value;
            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const resultCard = document.getElementById('resultCard');

            // Hide messages
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            resultCard.style.display = 'none';

            // Collect answers
            const answers = [];
            for (let i = 0; i < questions.length; i++) {
                const answer = document.querySelector(`input[name="q${i}"]:checked`);
                if (!answer) {
                    errorMessage.textContent = `Mohon jawab semua pertanyaan! Pertanyaan ${i + 1} belum dijawab.`;
                    errorMessage.style.display = 'block';
                    document.querySelector(`input[name="q${i}"]`).closest('.question-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }
                answers.push(answer.value);
            }

            // Calculate score using 4.16 scoring method
            let correctAnswers = 0;
            for (let i = 0; i < answers.length; i++) {
                if (answers[i] === 'tidak_tahu') {
                    continue;
                }
                const isCorrect = (answers[i] === 'benar' && answerKey[i]) || 
                                 (answers[i] === 'salah' && !answerKey[i]);
                if (isCorrect) {
                    correctAnswers++;
                }
            }

            // Calculate score: (correct answers / 24) * 100
            const score = ((correctAnswers / 24) * 100).toFixed(2);
            
            // Interpretation based on score
            let interpretation = '';
            let interpretationText = '';
            if (score >= 75) {
                interpretation = 'üåü Pengetahuan Baik';
                interpretationText = 'Anda memiliki pemahaman yang sangat baik tentang diabetes';
            } else if (score >= 50) {
                interpretation = 'üìö Pengetahuan Cukup';
                interpretationText = 'Anda memiliki pemahaman dasar tentang diabetes, namun masih perlu ditingkatkan';
            } else {
                interpretation = '‚ö†Ô∏è Pengetahuan Kurang';
                interpretationText = 'Disarankan untuk mempelajari lebih lanjut tentang diabetes';
            }

            // Display result first
            resultCard.innerHTML = `
                <h2>‚úÖ Hasil Kuesioner</h2>
                <div class="score">${score}%</div>
                <p><strong>Jawaban Benar:</strong> ${correctAnswers} dari 24</p>
                <div class="interpretation">${interpretation}<br>${interpretationText}</div>
            `;
            resultCard.style.display = 'block';
            resultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Mengirim ke Google Sheets...';

            // Prepare data for Google Sheets
            const timestamp = new Date().toLocaleString('id-ID', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            const formData = {
                timestamp: timestamp,
                nama: nama,
                answers: answers,
                correctAnswers: correctAnswers,
                score: score,
                interpretation: `${interpretation} - ${interpretationText}`
            };

            // Send to Google Sheets
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                successMessage.innerHTML = '‚úÖ <strong>Data berhasil disimpan ke Google Sheets!</strong><br>Terima kasih atas partisipasi Anda.';
                successMessage.style.display = 'block';
                
                submitBtn.textContent = '‚úì Submit Berhasil';
                
                // Disable form after successful submission
                setTimeout(() => {
                    document.getElementById('dkqForm').style.opacity = '0.6';
                    const inputs = document.querySelectorAll('input');
                    inputs.forEach(input => input.disabled = true);
                }, 1000);

            } catch (error) {
                console.error('Error:', error);
                
                // Even with no-cors, we assume success if no error thrown
                successMessage.innerHTML = '‚úÖ <strong>Data berhasil dikirim!</strong><br>Terima kasih atas partisipasi Anda.';
                successMessage.style.display = 'block';
                
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úì Selesai';
            }
        });
    </script>
</body>
</html>
